---
title: 'Security'
description: 'Security best practices for the OpenLIT Operator'
icon: 'shield-check'
---

Implement robust security practices for the OpenLIT Operator in production environments, covering RBAC, TLS, network security, and compliance considerations.

## üõ°Ô∏è Security Overview

The OpenLIT Operator implements multiple security layers:

<CardGroup cols={2}>
  <Card title="üîê RBAC Security" icon="key">
    Role-based access control with minimal required permissions
  </Card>
  <Card title="üîí TLS Encryption" icon="lock">
    Automatic TLS certificate management for webhook security
  </Card>
  <Card title="üåê Network Security" icon="shield">
    Network policies and secure communication channels
  </Card>
  <Card title="üìã Compliance" icon="clipboard-check">
    Security compliance and audit capabilities
  </Card>
</CardGroup>

## üîê RBAC Configuration

### Minimal Permissions

The operator uses the principle of least privilege:

```yaml
# ClusterRole with minimal required permissions
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: openlit-operator
rules:
# AutoInstrumentation CRD management
- apiGroups: ["openlit.io"]
  resources: ["autoinstrumentations"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

# Pod inspection and mutation
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]

# Webhook configuration management
- apiGroups: ["admissionregistration.k8s.io"]
  resources: ["mutatingwebhookconfigurations"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

# Certificate management
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

# ConfigMap access for configuration
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "list", "watch"]
```

### Custom ServiceAccount

For enhanced security, use a custom ServiceAccount:

```yaml
# Custom ServiceAccount with restricted permissions
apiVersion: v1
kind: ServiceAccount
metadata:
  name: openlit-operator-restricted
  namespace: openlit
  annotations:
    # AWS IRSA annotation
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT:role/OpenLITOperatorRole

---
# Install with custom ServiceAccount
helm install openlit-operator openlit/openlit-operator \
  --set serviceAccount.create=false \
  --set serviceAccount.name=openlit-operator-restricted
```

### Namespace-Scoped Deployment

Deploy operator with namespace-limited scope:

```yaml
# Namespace-scoped RBAC
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: ai-applications
  name: openlit-operator-namespaced
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["openlit.io"]
  resources: ["autoinstrumentations"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: openlit-operator-namespaced
  namespace: ai-applications
subjects:
- kind: ServiceAccount
  name: openlit-operator
  namespace: openlit
roleRef:
  kind: Role
  name: openlit-operator-namespaced
  apiGroup: rbac.authorization.k8s.io
```

## üîí TLS and Certificate Security

### Automatic Certificate Management

The operator automatically manages TLS certificates:

```yaml
# Certificate configuration
webhook:
  tls:
    autoGenerate: true
    duration: "8760h"  # 1 year
    renewBefore: "720h"  # 30 days before expiry
    
    # Certificate storage
    secretName: "webhook-tls-secret"
    secretNamespace: "openlit"
```

### Certificate Monitoring

Monitor certificate health:

```yaml
# Certificate expiry monitoring
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: openlit-operator-certs
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: openlit-operator
  endpoints:
  - port: metrics
    path: /metrics
    interval: 30s

---
# Prometheus alert for certificate expiry
groups:
- name: openlit-certificates
  rules:
  - alert: WebhookCertificateExpiring
    expr: openlit_webhook_certificate_expiry_seconds < 30 * 24 * 3600
    for: 1h
    labels:
      severity: warning
    annotations:
      summary: "Webhook certificate expires in less than 30 days"
      description: "Certificate will expire on {{ $value | humanizeTimestamp }}"
```

### Custom Certificate Authority

Use a custom CA for enhanced security:

```yaml
# Custom CA secret
apiVersion: v1
kind: Secret
metadata:
  name: custom-ca
  namespace: openlit
type: Opaque
data:
  ca.crt: <base64-encoded-ca-cert>
  ca.key: <base64-encoded-ca-key>

---
# Configure operator to use custom CA
webhook:
  tls:
    autoGenerate: false
    caSecretName: "custom-ca"
    secretName: "custom-webhook-tls"
```

## üåê Network Security

### Network Policies

Implement network segmentation:

```yaml
# Operator ingress policy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: openlit-operator-ingress
  namespace: openlit
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: openlit-operator
  policyTypes:
  - Ingress
  ingress:
  # Allow webhook traffic from kube-apiserver
  - from:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: TCP
      port: 9443
  # Allow metrics scraping
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    ports:
    - protocol: TCP
      port: 8080

---
# Operator egress policy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: openlit-operator-egress
  namespace: openlit
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: openlit-operator
  policyTypes:
  - Egress
  egress:
  # Allow Kubernetes API access
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: TCP
      port: 443
  # Allow DNS resolution
  - to: []
    ports:
    - protocol: UDP
      port: 53
```

### Service Mesh Integration

Secure with Istio service mesh:

```yaml
# Istio VirtualService for operator
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: openlit-operator
  namespace: openlit
spec:
  hosts:
  - openlit-operator-webhook-service.openlit.svc.cluster.local
  http:
  - match:
    - uri:
        prefix: /mutate
    route:
    - destination:
        host: openlit-operator-webhook-service.openlit.svc.cluster.local
        port:
          number: 443

---
# Istio DestinationRule for TLS
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: openlit-operator
  namespace: openlit
spec:
  host: openlit-operator-webhook-service.openlit.svc.cluster.local
  trafficPolicy:
    tls:
      mode: SIMPLE
```

## üîê Secret Management

### API Key Security

Secure handling of sensitive data:

```yaml
# Secure secret creation
apiVersion: v1
kind: Secret
metadata:
  name: openlit-secrets
  namespace: production
type: Opaque
stringData:
  openai-api-key: "sk-proj-..."
  anthropic-api-key: "sk-ant-..."
  openlit-api-key: "..."

---
# Reference secrets in AutoInstrumentation
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: production-instrumentation
  namespace: production
spec:
  python:
    instrumentation:
      env:
      - name: OPENAI_API_KEY
        valueFrom:
          secretKeyRef:
            name: openlit-secrets
            key: openai-api-key
      - name: OPENLIT_API_KEY
        valueFrom:
          secretKeyRef:
            name: openlit-secrets
            key: openlit-api-key
  otlp:
    endpoint: "https://traces.company.com:4318"
```

### External Secret Management

Integration with external secret stores:

```yaml
# AWS Secrets Manager integration
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: production
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-west-2
      auth:
        secretRef:
          accessKeyIDSecretRef:
            name: aws-credentials
            key: access-key-id
          secretAccessKeySecretRef:
            name: aws-credentials
            key: secret-access-key

---
# External secret
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: openlit-external-secrets
  namespace: production
spec:
  refreshInterval: 15s
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: openlit-secrets
    creationPolicy: Owner
  data:
  - secretKey: openai-api-key
    remoteRef:
      key: openlit/prod/openai-key
  - secretKey: openlit-api-key
    remoteRef:
      key: openlit/prod/api-key
```

## üîç Security Monitoring

### Audit Logging

Enable Kubernetes audit logging for operator activities:

```yaml
# Audit policy for operator events
apiVersion: audit.k8s.io/v1
kind: Policy
rules:
# Monitor operator pod mutations
- level: Request
  resources:
  - group: ""
    resources: ["pods"]
  verbs: ["create", "update", "patch"]
  namespaces: ["production", "staging"]

# Monitor AutoInstrumentation changes
- level: RequestResponse
  resources:
  - group: "openlit.io"
    resources: ["autoinstrumentations"]
  verbs: ["create", "update", "patch", "delete"]

# Monitor webhook configuration changes
- level: RequestResponse
  resources:
  - group: "admissionregistration.k8s.io"
    resources: ["mutatingwebhookconfigurations"]
  verbs: ["create", "update", "patch", "delete"]
```

### Security Metrics

Monitor security-related metrics:

```yaml
# Security monitoring dashboard
apiVersion: v1
kind: ConfigMap
metadata:
  name: security-dashboard
data:
  dashboard.json: |
    {
      "dashboard": {
        "title": "OpenLIT Operator Security",
        "panels": [
          {
            "title": "Certificate Expiry",
            "type": "stat",
            "targets": [
              {
                "expr": "(openlit_webhook_certificate_expiry_seconds - time()) / 86400",
                "legendFormat": "Days until expiry"
              }
            ]
          },
          {
            "title": "Webhook Success Rate",
            "type": "stat",
            "targets": [
              {
                "expr": "rate(openlit_webhook_requests_total{status=\"success\"}[5m]) / rate(openlit_webhook_requests_total[5m])",
                "legendFormat": "Success Rate"
              }
            ]
          },
          {
            "title": "Failed Authentications",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(openlit_webhook_requests_total{status=\"unauthorized\"}[5m])",
                "legendFormat": "Auth Failures"
              }
            ]
          }
        ]
      }
    }
```

## üè¢ Compliance and Governance

### SOC 2 Compliance

Implement SOC 2 controls:

```yaml
# SOC 2 compliant configuration
observability:
  # Enable comprehensive logging
  logLevel: "info"
  auditLogs: true
  
  # Encrypt logs in transit
  logForwarding:
    endpoint: "https://secure-logs.company.com"
    tls:
      enabled: true
      verify: true

security:
  # Regular key rotation
  keyRotation:
    enabled: true
    interval: "30d"
  
  # Access controls
  rbac:
    strictMode: true
    minimumPermissions: true
  
  # Data encryption
  encryption:
    atRest: true
    inTransit: true
```

### PCI DSS Compliance

For environments handling payment data:

```yaml
# PCI DSS compliant deployment
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 3000
  fsGroup: 2000
  seccompProfile:
    type: RuntimeDefault
  capabilities:
    drop:
    - ALL

# Network segmentation
networkPolicy:
  enabled: true
  denyAll: true
  allowKubernetesAPI: true
  
# Data protection
dataProtection:
  encryptSecrets: true
  maskSensitiveData: true
  retentionPeriod: "90d"
```

### GDPR Compliance

Handle personally identifiable information (PII):

```yaml
# GDPR compliant configuration
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: gdpr-compliant-instrumentation
spec:
  python:
    instrumentation:
      env:
      # Disable message content capture
      - name: OTEL_INSTRUMENTATION_GENAI_CAPTURE_MESSAGE_CONTENT
        value: "false"
      
      # Enable data anonymization
      - name: OPENLIT_ANONYMIZE_DATA
        value: "true"
      
      # Set data retention
      - name: OPENLIT_DATA_RETENTION
        value: "30d"
  
  # Use regional OTLP endpoint
  otlp:
    endpoint: "https://eu-traces.company.com:4318"
```

## üîß Security Hardening

### Container Security

Harden operator containers:

```yaml
# Security-hardened deployment
securityContext:
  # Run as non-root user
  runAsNonRoot: true
  runAsUser: 65534  # nobody user
  runAsGroup: 65534
  fsGroup: 65534
  
  # Read-only root filesystem
  readOnlyRootFilesystem: true
  
  # Drop all capabilities
  capabilities:
    drop:
    - ALL
  
  # Use seccomp profile
  seccompProfile:
    type: RuntimeDefault

# Resource limits
resources:
  limits:
    cpu: "200m"
    memory: "256Mi"
    ephemeral-storage: "1Gi"
  requests:
    cpu: "100m"
    memory: "128Mi"
    ephemeral-storage: "500Mi"

# Pod security standards
podSecurityContext:
  seccompProfile:
    type: RuntimeDefault
  supplementalGroups: []
```

### Image Security

Ensure container image security:

```yaml
# Image security configuration
image:
  repository: ghcr.io/openlit/openlit-operator
  tag: "v1.2.0"  # Use specific version, not latest
  pullPolicy: Always  # Always pull for security updates
  
  # Image pull secrets for private registries
  pullSecrets:
  - name: ghcr-secret

# Image scanning policy
imageScanPolicy:
  enabled: true
  severity: "HIGH"
  vulnerabilityDatabase: "trivy"
  scanSchedule: "0 2 * * *"  # Daily at 2 AM
```

### Supply Chain Security

Verify image integrity:

```bash
# Verify image signatures with cosign
cosign verify ghcr.io/openlit/openlit-operator:v1.2.0 \
  --certificate-identity-regexp="https://github.com/openlit/openlit" \
  --certificate-oidc-issuer="https://token.actions.githubusercontent.com"

# Check SBOM (Software Bill of Materials)
cosign download sbom ghcr.io/openlit/openlit-operator:v1.2.0

# Verify provenance
cosign verify-attestation ghcr.io/openlit/openlit-operator:v1.2.0 \
  --type slsaprovenance \
  --certificate-identity-regexp="https://github.com/openlit/openlit" \
  --certificate-oidc-issuer="https://token.actions.githubusercontent.com"
```

## üö® Incident Response

### Security Event Detection

Automated security monitoring:

```yaml
# Security alert rules
groups:
- name: openlit-security
  rules:
  - alert: UnauthorizedWebhookAccess
    expr: rate(openlit_webhook_requests_total{status="unauthorized"}[5m]) > 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Unauthorized access to operator webhook"
      
  - alert: CertificateNearExpiry
    expr: openlit_webhook_certificate_expiry_seconds - time() < 7 * 24 * 3600
    for: 1h
    labels:
      severity: warning
    annotations:
      summary: "Webhook certificate expires in less than 7 days"
      
  - alert: HighInstrumentationFailureRate
    expr: rate(openlit_instrumentation_failures_total[5m]) > 0.1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High rate of instrumentation failures detected"
```

### Security Playbooks

Incident response procedures:

```bash
#!/bin/bash
# Security incident response script

# 1. Isolate affected components
kubectl scale deployment openlit-operator --replicas=0 -n openlit

# 2. Collect forensic data
kubectl logs deployment/openlit-operator -n openlit > operator-logs.txt
kubectl get events --all-namespaces > cluster-events.txt

# 3. Check for compromise indicators
kubectl get pods --all-namespaces -o wide | grep -E "(Pending|Error|Unknown)"
kubectl get autoinstrumentations --all-namespaces -o yaml > autoinstrumentation-dump.yaml

# 4. Rotate certificates
kubectl delete secret webhook-tls-secret -n openlit
kubectl rollout restart deployment/openlit-operator -n openlit

# 5. Update security policies
kubectl apply -f security-policies/
```

## üìñ Next Steps

<CardGroup cols={2}>
  <Card title="üìö API Reference" href="/latest/operator/api-reference" icon="book">
    Complete API documentation
  </Card>
  <Card title="üîß Troubleshooting" href="/latest/operator/troubleshooting" icon="wrench">
    Debug security-related issues
  </Card>
  <Card title="üèóÔ∏è Architecture" href="/latest/operator/architecture" icon="sitemap">
    Understand security architecture
  </Card>
  <Card title="‚öôÔ∏è Configuration" href="/latest/operator/configuration" icon="gear">
    Security configuration options
  </Card>
</CardGroup>
