---
title: 'AutoInstrumentation CR'
description: 'Configure AutoInstrumentation Custom Resources with detailed parameters'
---

Configure AutoInstrumentation Custom Resources to define how your applications should be instrumented. This page provides detailed tables with all parameters, default values, examples, and descriptions.

## üìã Overview

The `AutoInstrumentation` Custom Resource is the primary configuration interface for defining:

- **Which pods** to instrument (selectors)
- **How to instrument** them (provider, packages, environment)
- **Where to send** telemetry data (OTLP configuration)
- **What attributes** to include (resource attributes)

## üéØ Resource Structure

### Basic Structure

```yaml
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: example-instrumentation
  namespace: default
spec:
  selector: {}           # Pod selection criteria
  ignore: {}             # Pods to ignore  
  python: {}             # Python instrumentation config
  otlp: {}               # OTLP endpoint configuration
  resource: {}           # Resource attributes
status: {}               # Resource status (read-only)
```

## üîç Pod Selection Configuration

Configure which pods should be instrumented using label selectors.

### Selector Parameters

| Parameter | Type | Description | Default | Example |
|-----------|------|-------------|---------|---------|
| `spec.selector` | `LabelSelector` | Pods to instrument | Required | See examples below |
| `spec.selector.matchLabels` | `map[string]string` | Exact label matches | `{}` | `{"app": "chatbot"}` |
| `spec.selector.matchExpressions` | `[]LabelSelectorRequirement` | Expression-based matching | `[]` | See expressions table |

### Match Expressions

| Field | Type | Description | Values | Example |
|-------|------|-------------|---------|---------|
| `key` | `string` | Label key to match | Any label key | `"environment"` |
| `operator` | `string` | Matching operator | `In`, `NotIn`, `Exists`, `DoesNotExist` | `"In"` |
| `values` | `[]string` | Values to match (for In/NotIn) | List of strings | `["prod", "staging"]` |

**Examples:**

```yaml
# Basic label matching
spec:
  selector:
    matchLabels:
      openlit.io/instrument: "true"
      app: "ai-chatbot"

# Advanced expression matching  
spec:
  selector:
    matchExpressions:
    - key: "environment"
      operator: In
      values: ["production", "staging"]
    - key: "ai-framework"
      operator: Exists
    - key: "legacy-app"
      operator: DoesNotExist
```

### Ignore Configuration

| Parameter | Type | Description | Default | Example |
|-----------|------|-------------|---------|---------|
| `spec.ignore` | `LabelSelector` | Pods to skip even if they match selector | `{}` | See example |
| `spec.ignore.matchLabels` | `map[string]string` | Exact label matches to ignore | `{}` | `{"debug": "true"}` |
| `spec.ignore.matchExpressions` | `[]LabelSelectorRequirement` | Expression-based ignoring | `[]` | System pods |

**Example:**
```yaml
spec:
  ignore:
    matchLabels:
      openlit.io/skip: "true"
      system-component: "true"
    matchExpressions:
    - key: "debug-mode"
      operator: Exists
```

## üêç Python Instrumentation Configuration

Configure Python-specific instrumentation settings.

### Instrumentation Parameters

| Parameter | Type | Description | Default | Example |
|-----------|------|-------------|---------|---------|
| `spec.python.instrumentation.enabled` | `bool` | Enable Python instrumentation | `true` | `false` |
| `spec.python.instrumentation.provider` | `string` | Instrumentation provider | `"openlit"` | `"openinference"` |
| `spec.python.instrumentation.version` | `string` | Provider version | `"latest"` | `"v1.0.0"` |
| `spec.python.instrumentation.customInitImage` | `string` | Custom init container image | `""` | `"custom-registry.com/openlit:v1.0"` |
| `spec.python.instrumentation.imagePullPolicy` | `string` | Image pull policy | `"IfNotPresent"` | `"Always"` |
| `spec.python.instrumentation.customPackages` | `string` | Additional pip packages | `""` | `"langchain>=0.1.0,chromadb>=0.4.0"` |

### Supported Providers

| Provider | Description | Use Case | Image Repository |
|----------|-------------|----------|------------------|
| `"openlit"` | Full OpenLIT instrumentation | Complete AI observability | `ghcr.io/openlit/openlit-ai-instrumentation` |
| `"openinference"` | OpenInference standard | OpenTelemetry standard compliance | `ghcr.io/openlit/openinference-ai-instrumentation` |
| `"openllmetry"` | OpenLLMetry instrumentation | LLM-focused observability | `ghcr.io/openlit/openllmetry-ai-instrumentation` |
| `"custom"` | Custom instrumentation | Custom implementation | User-defined via `customInitImage` |

**Examples:**

```yaml
# OpenLIT provider with custom packages
spec:
  python:
    instrumentation:
      enabled: true
      provider: "openlit"
      version: "latest"
      customPackages: "langchain>=0.1.0,chromadb>=0.4.0,numpy==1.21.0"

# OpenInference provider
spec:
  python:
    instrumentation:
      provider: "openinference"
      version: "v0.5.0"

# Custom provider
spec:
  python:
    instrumentation:
      provider: "custom"
      customInitImage: "my-registry.com/custom-openlit:v2.0.0"
      imagePullPolicy: "Always"
```

### Environment Variables

| Parameter | Type | Description | Default | Example |
|-----------|------|-------------|---------|---------|
| `spec.python.instrumentation.env` | `[]EnvVar` | Environment variables for instrumented containers | `[]` | See examples |
| `spec.python.instrumentation.env[].name` | `string` | Environment variable name | Required | `"OPENLIT_API_KEY"` |
| `spec.python.instrumentation.env[].value` | `string` | Direct value | `""` | `"debug-mode"` |
| `spec.python.instrumentation.env[].valueFrom` | `EnvVarSource` | Value from external source | `nil` | Secret/ConfigMap reference |

### Environment Variable Sources

| Source Type | Field | Description | Example |
|-------------|-------|-------------|---------|
| `secretKeyRef` | `name`, `key` | Value from Kubernetes Secret | `{name: "openlit-secret", key: "api-key"}` |
| `configMapKeyRef` | `name`, `key` | Value from ConfigMap | `{name: "openlit-config", key: "endpoint"}` |
| `fieldRef` | `fieldPath` | Value from pod/container field | `{fieldPath: "metadata.name"}` |
| `resourceFieldRef` | `resource` | Value from resource field | `{resource: "requests.cpu"}` |

**Examples:**

```yaml
spec:
  python:
    instrumentation:
      env:
      # Direct value
      - name: OPENLIT_DEBUG
        value: "true"
      
      # From secret
      - name: OPENLIT_API_KEY
        valueFrom:
          secretKeyRef:
            name: openlit-secret
            key: api-key
      
      # From configmap
      - name: OPENLIT_ENDPOINT
        valueFrom:
          configMapKeyRef:
            name: openlit-config
            key: otlp-endpoint
      
      # From pod metadata
      - name: POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
      
      # From resource request
      - name: CPU_REQUEST
        valueFrom:
          resourceFieldRef:
            resource: requests.cpu
```

## üåê OTLP Configuration

Configure OpenTelemetry Protocol (OTLP) endpoint settings.

### OTLP Parameters

| Parameter | Type | Description | Default | Example | Validation |
|-----------|------|-------------|---------|---------|------------|
| `spec.otlp.endpoint` | `string` | OTLP endpoint URL | Required | `"http://openlit:4318"` | Valid HTTP/HTTPS URL |
| `spec.otlp.headers` | `string` | HTTP headers (comma-separated) | `""` | `"authorization=Bearer token123"` | `key=value` format |
| `spec.otlp.timeout` | `int` | Request timeout in seconds | `30` | `60` | 1-300 seconds |

### Endpoint Formats

| Format | Description | Example | Use Case |
|--------|-------------|---------|----------|
| Internal Service | Kubernetes service reference | `http://openlit:4318` | Same cluster deployment |
| Fully Qualified | Full service DNS name | `http://openlit.openlit.svc.cluster.local:4318` | Cross-namespace access |
| External HTTPS | External secure endpoint | `https://traces.example.com:4318` | Cloud/external services |
| Load Balancer | Load balancer endpoint | `http://otlp-lb.company.com:4318` | High availability setup |

### Headers Format

Headers should be comma-separated key=value pairs:

| Header Type | Format | Example | Use Case |
|-------------|--------|---------|----------|
| Authorization | `authorization=Bearer <token>` | `"authorization=Bearer abc123"` | API authentication |
| API Key | `x-api-key=<key>` | `"x-api-key=secret456"` | API key authentication |
| Multiple Headers | `key1=val1,key2=val2` | `"auth=token,x-trace-id=123"` | Multiple authentication |
| URL Encoded | URL-encoded special chars | `"auth=Bearer%20token"` | Special characters |

**Examples:**

```yaml
# Basic OTLP configuration
spec:
  otlp:
    endpoint: "http://openlit:4318"
    timeout: 30

# With authentication headers
spec:
  otlp:
    endpoint: "https://traces.example.com:4318"
    headers: "authorization=Bearer token123,x-api-key=secret456"
    timeout: 60

# Internal service with FQDN
spec:
  otlp:
    endpoint: "http://openlit.openlit.svc.cluster.local:4318"
    timeout: 45
```

## üè∑Ô∏è Resource Attributes

Configure resource attributes that will be added to all telemetry data.

### Resource Parameters

| Parameter | Type | Description | Default | Example | OpenTelemetry Mapping |
|-----------|------|-------------|---------|---------|----------------------|
| `spec.resource.environment` | `string` | Deployment environment | `""` | `"production"` | `deployment.environment` |
| `spec.resource.serviceName` | `string` | Service name override | `""` | `"ai-chat-service"` | `service.name` |
| `spec.resource.serviceNamespace` | `string` | Service namespace | `""` | `"ai-platform"` | `service.namespace` |
| `spec.resource.serviceVersion` | `string` | Service version | `""` | `"v2.1.0"` | `service.version` |

### Automatic Attributes

The operator automatically sets these attributes (cannot be overridden):

| Attribute | Source | Example | Description |
|-----------|--------|---------|-------------|
| `k8s.pod.name` | Pod metadata | `"chatbot-abc123"` | Kubernetes pod name |
| `k8s.namespace.name` | Pod namespace | `"production"` | Kubernetes namespace |
| `k8s.deployment.name` | Owner reference | `"ai-chatbot"` | Deployment name (if applicable) |
| `k8s.replicaset.name` | Owner reference | `"ai-chatbot-xyz789"` | ReplicaSet name (if applicable) |
| `k8s.node.name` | Pod spec | `"worker-node-1"` | Node where pod is running |

**Examples:**

```yaml
# Basic resource attributes
spec:
  resource:
    environment: "production"
    serviceName: "customer-support-ai"
    serviceNamespace: "ai-platform"
    serviceVersion: "v2.1.0"

# Environment-specific configuration
spec:
  resource:
    environment: "staging"
    serviceName: "experiment-chatbot"
    serviceNamespace: "research"
```

## üìä Status Information

The operator updates the AutoInstrumentation status with operational information.

### Status Fields (Read-Only)

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `status.conditions` | `[]Condition` | Resource conditions | See conditions table |
| `status.observedGeneration` | `int64` | Last processed generation | `1` |
| `status.phase` | `string` | Current phase | `"Ready"` |

### Condition Types

| Type | Status | Reason | Description |
|------|--------|--------|-------------|
| `Ready` | `True` | `ValidationSucceeded` | Configuration is valid and active |
| `Ready` | `False` | `ValidationFailed` | Configuration has validation errors |
| `Ready` | `False` | `ProcessingError` | Internal processing error |

**Example Status:**
```yaml
status:
  conditions:
  - type: Ready
    status: "True"
    reason: ValidationSucceeded
    message: "AutoInstrumentation is ready and active"
    lastTransitionTime: "2024-01-15T10:30:00Z"
  observedGeneration: 1
  phase: Ready
```

## ‚úÖ Validation Rules

The operator validates AutoInstrumentation configurations with these rules:

### Required Fields

| Field | Validation | Error Message |
|-------|------------|---------------|
| `spec.selector` | Must not be empty | "selector is required" |
| `spec.otlp.endpoint` | Must be valid URL | "otlp.endpoint must be a valid HTTP/HTTPS URL" |

### Format Validation

| Field | Format | Valid Examples | Invalid Examples |
|-------|--------|---------------|------------------|
| `spec.otlp.endpoint` | HTTP/HTTPS URL | `http://service:4318`, `https://traces.com:4318` | `ftp://invalid`, `invalid-url` |
| `spec.otlp.timeout` | 1-300 seconds | `30`, `120`, `300` | `0`, `301`, `-5` |
| `spec.python.instrumentation.provider` | Enum | `openlit`, `openinference`, `openllmetry`, `custom` | `invalid-provider` |

### Custom Package Format

| Format | Description | Valid Examples | Invalid Examples |
|--------|-------------|---------------|------------------|
| Pip packages | Comma-separated pip requirements | `langchain>=0.1.0,chromadb` | `invalid syntax,` |
| Version specs | Standard pip version specifiers | `package==1.0.0`, `pkg>=2.0,<3.0` | `package=invalid` |
| Multiple packages | Comma-separated list | `pkg1>=1.0,pkg2,pkg3==2.0` | `pkg1,, pkg2` |

## üé® Configuration Examples

### Multi-Environment Setup

```yaml
# Production environment
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: production-instrumentation
  namespace: production
spec:
  selector:
    matchLabels:
      environment: "production"
  python:
    instrumentation:
      provider: "openlit"
      customPackages: "langchain>=0.1.0,chromadb>=0.4.0"
      env:
      - name: OPENLIT_ENVIRONMENT
        value: "production"
      - name: OPENLIT_API_KEY
        valueFrom:
          secretKeyRef:
            name: openlit-prod-secret
            key: api-key
  otlp:
    endpoint: "https://prod-traces.company.com:4318"
    headers: "authorization=Bearer prod-token"
    timeout: 60
  resource:
    environment: "production"
    serviceNamespace: "ai-platform"

---
# Staging environment
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: staging-instrumentation
  namespace: staging
spec:
  selector:
    matchLabels:
      environment: "staging"
  python:
    instrumentation:
      provider: "openinference"
      version: "v0.5.0"
  otlp:
    endpoint: "http://staging-openlit:4318"
    timeout: 30
  resource:
    environment: "staging"
    serviceNamespace: "testing"
```

### Framework-Specific Configurations

```yaml
# LangChain applications
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: langchain-instrumentation
spec:
  selector:
    matchLabels:
      ai-framework: "langchain"
  python:
    instrumentation:
      provider: "openlit"
      customPackages: "langchain>=0.1.0,langchain-community>=0.0.20,langchain-openai>=0.0.5"
      env:
      - name: OPENLIT_CAPTURE_MESSAGE_CONTENT
        value: "true"
  otlp:
    endpoint: "http://openlit:4318"
  resource:
    serviceNamespace: "langchain-apps"

---
# LlamaIndex applications  
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: llamaindex-instrumentation
spec:
  selector:
    matchLabels:
      ai-framework: "llamaindex"
  python:
    instrumentation:
      provider: "openlit"
      customPackages: "llama-index>=0.9.0,llama-index-vector-stores-chroma>=0.1.0"
  otlp:
    endpoint: "http://openlit:4318"
  resource:
    serviceNamespace: "llamaindex-apps"
```

### High-Security Configuration

```yaml
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: secure-instrumentation
  namespace: secure-apps
spec:
  selector:
    matchLabels:
      security-level: "high"
    matchExpressions:
    - key: "pci-compliant"
      operator: Exists
  ignore:
    matchLabels:
      openlit.io/skip: "true"
  python:
    instrumentation:
      provider: "openlit"
      version: "v1.0.0"  # Pinned version
      imagePullPolicy: "IfNotPresent"
      env:
      - name: OPENLIT_CAPTURE_MESSAGE_CONTENT
        value: "false"  # No message content capture
      - name: OPENLIT_REDACT_PII
        value: "true"   # Enable PII redaction
      - name: OPENLIT_API_KEY
        valueFrom:
          secretKeyRef:
            name: secure-openlit-secret
            key: encrypted-api-key
  otlp:
    endpoint: "https://secure-traces.company.com:4318"
    headers: "authorization=Bearer secure-token,x-security-level=high"
    timeout: 30
  resource:
    environment: "production"
    serviceName: "secure-ai-service"
    serviceNamespace: "security"
```

## üìñ Next Steps

<CardGroup cols={2}>
  <Card title="üéØ Instrumentations" href="/latest/operator/instrumentations-overview" icon="target">
    Learn about different instrumentation providers
  </Card>
  <Card title="üåê Destinations" href="/latest/operator/destinations-overview" icon="globe">
    Configure trace destinations and backends
  </Card>
  <Card title="üîß Troubleshooting" href="/latest/operator/troubleshooting" icon="wrench">
    Debug AutoInstrumentation configuration issues
  </Card>
  <Card title="üìö API Reference" href="/latest/operator/api-reference" icon="book">
    Complete API specification and examples
  </Card>
</CardGroup>
