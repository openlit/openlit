---
title: 'API Reference'
description: 'Complete API documentation for the OpenLIT Operator'
icon: 'book'
---

Complete API reference for the OpenLIT Operator, covering all Custom Resource Definitions, fields, validation rules, and examples.

## 📋 AutoInstrumentation CRD

The `AutoInstrumentation` Custom Resource Definition is the primary API for configuring zero-code instrumentation.

### API Version

```yaml
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
```

### Metadata

Standard Kubernetes metadata fields:

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | **Required.** Name of the AutoInstrumentation resource |
| `namespace` | string | **Required.** Namespace where the resource is created |
| `labels` | object | Optional labels for the resource |
| `annotations` | object | Optional annotations for the resource |

```yaml
metadata:
  name: my-instrumentation
  namespace: production
  labels:
    team: ai-platform
    environment: production
  annotations:
    description: "Production AI application instrumentation"
```

## 🎯 Spec Fields

### Selector

Defines which pods should be instrumented.

| Field | Type | Description |
|-------|------|-------------|
| `selector.matchLabels` | object | Label selector for pods |
| `selector.matchExpressions` | array | Expression-based selector for pods |

#### matchLabels

```yaml
spec:
  selector:
    matchLabels:
      openlit.io/instrument: "true"
      app: "chatbot"
      version: "v2"
```

#### matchExpressions

```yaml
spec:
  selector:
    matchExpressions:
    - key: "environment"
      operator: In
      values: ["production", "staging"]
    - key: "ai-framework"
      operator: Exists
    - key: "legacy-app"
      operator: DoesNotExist
```

**Supported operators:**
- `In`: Label value must be in the specified list
- `NotIn`: Label value must not be in the specified list
- `Exists`: Label key must exist (any value)
- `DoesNotExist`: Label key must not exist

### Ignore

Defines pods to exclude from instrumentation even if they match the selector.

| Field | Type | Description |
|-------|------|-------------|
| `ignore.matchLabels` | object | Label selector for pods to ignore |
| `ignore.matchExpressions` | array | Expression-based selector for pods to ignore |

```yaml
spec:
  ignore:
    matchLabels:
      openlit.io/skip: "true"
      system-component: "true"
    matchExpressions:
    - key: "debug-mode"
      operator: Exists
```

### Python Configuration

Configures Python-specific instrumentation settings.

| Field | Type | Description | Default |
|-------|------|-------------|---------|
| `python.instrumentation.enabled` | boolean | Enable/disable instrumentation | `true` |
| `python.instrumentation.provider` | string | Instrumentation provider | `"openlit"` |
| `python.instrumentation.version` | string | Instrumentation version | `"latest"` |
| `python.instrumentation.imagePullPolicy` | string | Image pull policy | `"IfNotPresent"` |
| `python.instrumentation.customPackages` | string | Custom packages to install | `""` |
| `python.instrumentation.customInitImage` | string | Custom init container image | `""` |
| `python.instrumentation.env` | array | Environment variables | `[]` |

#### Provider Options

| Provider | Description |
|----------|-------------|
| `openlit` | Full-featured OpenLIT instrumentation |
| `openinference` | OpenInference standard instrumentation |
| `openllmetry` | OpenLLMetry instrumentation |
| `custom` | Custom instrumentation image |

#### Custom Packages

```yaml
spec:
  python:
    instrumentation:
      customPackages: "langchain>=0.1.0,chromadb>=0.4.0,numpy==1.21.0"
```

**Format:**
- Comma-separated list of packages
- Supports pip version specifiers (`>=`, `==`, `~=`, etc.)
- Standard pip package specifications

#### Environment Variables

```yaml
spec:
  python:
    instrumentation:
      env:
      # Direct value
      - name: OPENLIT_DEBUG
        value: "true"
      
      # From secret
      - name: OPENLIT_API_KEY
        valueFrom:
          secretKeyRef:
            name: openlit-secret
            key: api-key
      
      # From configmap
      - name: OPENLIT_CONFIG
        valueFrom:
          configMapKeyRef:
            name: openlit-config
            key: config.yaml
      
      # From field reference
      - name: POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
```

### OTLP Configuration

Configures OpenTelemetry Protocol (OTLP) settings.

| Field | Type | Description | Validation |
|-------|------|-------------|------------|
| `otlp.endpoint` | string | **Required.** OTLP endpoint URL | Valid HTTP/HTTPS URL |
| `otlp.headers` | string | Additional headers | Key=value pairs |
| `otlp.timeout` | integer | Request timeout in seconds | 1-300 |

```yaml
spec:
  otlp:
    endpoint: "https://traces.company.com:4318"
    headers: "authorization=Bearer token123,x-api-key=secret456"
    timeout: 60
```

#### Endpoint Validation

**Valid endpoints:**
- `http://openlit:4318`
- `https://traces.example.com:4318`
- `http://otel-collector.monitoring.svc.cluster.local:4318`

**Invalid endpoints:**
- Empty string: `""`
- Invalid URL format: `"invalid-url"`
- Unsupported protocol: `"ftp://invalid:123"`

#### Headers Format

Headers are specified as comma-separated key=value pairs:
```yaml
headers: "authorization=Bearer token123,x-api-key=secret456,x-custom=value"
```

### Resource Configuration

Configures resource attributes for telemetry data.

| Field | Type | Description |
|-------|------|-------------|
| `resource.environment` | string | Deployment environment |
| `resource.serviceName` | string | Override service name |
| `resource.serviceNamespace` | string | Service namespace |

```yaml
spec:
  resource:
    environment: "production"
    serviceName: "ai-chat-service"
    serviceNamespace: "ai-platform"
```

#### Automatic Attributes

The operator automatically sets these attributes:
- `service.name`: From pod/deployment name
- `service.namespace`: From Kubernetes namespace
- `k8s.pod.name`: Pod name
- `k8s.namespace.name`: Namespace name
- `k8s.deployment.name`: Deployment name (if applicable)

## 📊 Status Fields

The operator updates the AutoInstrumentation status to reflect the current state.

### Status Structure

| Field | Type | Description |
|-------|------|-------------|
| `status.conditions` | array | Current conditions |
| `status.observedGeneration` | integer | Last observed generation |
| `status.phase` | string | Current phase |

### Conditions

| Type | Status | Reason | Description |
|------|--------|---------|-------------|
| `Ready` | `True` | `ValidationSucceeded` | Configuration is valid and active |
| `Ready` | `False` | `ValidationFailed` | Configuration has validation errors |
| `Ready` | `False` | `OTLPEndpointUnreachable` | OTLP endpoint cannot be reached |

### Phases

| Phase | Description |
|-------|-------------|
| `Pending` | Resource is being processed |
| `Ready` | Configuration is valid and active |
| `Error` | Configuration has validation errors |

### Example Status

```yaml
status:
  conditions:
  - type: "Ready"
    status: "True"
    reason: "ValidationSucceeded"
    message: "AutoInstrumentation is ready"
    lastTransitionTime: "2024-01-15T10:30:00Z"
  observedGeneration: 1
  phase: "Ready"
```

## 🔍 Validation Rules

### Field Validation

| Field | Validation Rule | Error Message |
|-------|----------------|---------------|
| `otlp.endpoint` | Must be a valid HTTP/HTTPS URL | "invalid OTLP endpoint URL" |
| `otlp.timeout` | Must be between 1 and 300 seconds | "timeout must be between 1 and 300 seconds" |
| `python.instrumentation.provider` | Must be one of: openlit, openinference, openllmetry, custom | "unsupported provider" |
| `python.instrumentation.version` | Must be a valid version string | "invalid version format" |
| `python.instrumentation.imagePullPolicy` | Must be one of: Always, IfNotPresent, Never | "invalid image pull policy" |

### Selector Validation

```yaml
# ✅ Valid selectors
selector:
  matchLabels:
    app: "chatbot"
  matchExpressions:
  - key: "version"
    operator: In
    values: ["v1", "v2"]

# ❌ Invalid selectors
selector:
  matchLabels: {}  # Empty matchLabels
  matchExpressions:
  - key: ""  # Empty key
    operator: InvalidOperator  # Invalid operator
```

### Custom Package Validation

```yaml
# ✅ Valid package specifications
customPackages: "langchain>=0.1.0,numpy==1.21.0,requests~=2.28.0"

# ❌ Invalid package specifications
customPackages: "invalid package name"  # Invalid format
customPackages: "package>=invalid_version"  # Invalid version
```

## 📝 Complete Examples

### Basic Configuration

```yaml
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: basic-instrumentation
  namespace: default
spec:
  selector:
    matchLabels:
      openlit.io/instrument: "true"
  otlp:
    endpoint: "http://openlit:4318"
```

### Advanced Configuration

```yaml
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: advanced-instrumentation
  namespace: production
  labels:
    team: ai-platform
    environment: production
spec:
  selector:
    matchLabels:
      openlit.io/instrument: "true"
      tier: "production"
    matchExpressions:
    - key: "framework"
      operator: In
      values: ["langchain", "llamaindex"]
    - key: "legacy"
      operator: DoesNotExist
  
  ignore:
    matchLabels:
      openlit.io/skip: "true"
      maintenance: "true"
  
  python:
    instrumentation:
      enabled: true
      provider: "openlit"
      version: "v1.2.0"
      imagePullPolicy: "IfNotPresent"
      customPackages: "langchain>=0.1.0,chromadb>=0.4.0"
      env:
      - name: OPENLIT_API_KEY
        valueFrom:
          secretKeyRef:
            name: openlit-secret
            key: api-key
      - name: OPENLIT_DEBUG
        value: "false"
  
  otlp:
    endpoint: "https://traces.company.com:4318"
    headers: "authorization=Bearer token123"
    timeout: 60
  
  resource:
    environment: "production"
    serviceName: "ai-platform-service"
    serviceNamespace: "ai-platform"
```

### Multi-Provider Configuration

```yaml
# OpenLIT provider
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: openlit-instrumentation
spec:
  selector:
    matchLabels:
      provider: "openlit"
  python:
    instrumentation:
      provider: "openlit"
      customPackages: "langchain>=0.1.0"
  otlp:
    endpoint: "http://openlit:4318"

---
# OpenInference provider
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: openinference-instrumentation
spec:
  selector:
    matchLabels:
      provider: "openinference"
  python:
    instrumentation:
      provider: "openinference"
      customPackages: "llama-index>=0.9.0"
  otlp:
    endpoint: "http://openlit:4318"

---
# Custom provider
apiVersion: openlit.io/v1alpha1
kind: AutoInstrumentation
metadata:
  name: custom-instrumentation
spec:
  selector:
    matchLabels:
      provider: "custom"
  python:
    instrumentation:
      provider: "custom"
      customInitImage: "my-registry.com/custom-openlit:v2.0.0"
  otlp:
    endpoint: "http://custom-collector:4318"
```

## 🔧 kubectl Commands

### Managing AutoInstrumentation Resources

```bash
# Create AutoInstrumentation
kubectl apply -f instrumentation.yaml

# List all AutoInstrumentation resources
kubectl get autoinstrumentations -A

# Describe specific resource
kubectl describe autoinstrumentation my-instrumentation

# Get resource in YAML format
kubectl get autoinstrumentation my-instrumentation -o yaml

# Edit resource
kubectl edit autoinstrumentation my-instrumentation

# Delete resource
kubectl delete autoinstrumentation my-instrumentation

# Watch for changes
kubectl get autoinstrumentations -w
```

### Validation and Testing

```bash
# Validate YAML before applying
kubectl apply -f instrumentation.yaml --dry-run=client

# Server-side validation
kubectl apply -f instrumentation.yaml --dry-run=server

# Check resource status
kubectl get autoinstrumentation my-instrumentation -o jsonpath='{.status.phase}'

# Get conditions
kubectl get autoinstrumentation my-instrumentation -o jsonpath='{.status.conditions[*].type}'

# Check for validation errors
kubectl get autoinstrumentation my-instrumentation -o jsonpath='{.status.conditions[?(@.type=="Ready")].message}'
```

### Debugging

```bash
# Check operator logs
kubectl logs -n openlit deployment/openlit-operator

# Monitor webhook activity
kubectl logs -n openlit deployment/openlit-operator | grep webhook

# Check mutating webhook configuration
kubectl get mutatingwebhookconfigurations openlit-operator-mutating-webhook-configuration -o yaml

# List instrumented pods
kubectl get pods -l openlit.io/instrument=true --all-namespaces

# Check pod for instrumentation
kubectl describe pod <pod-name> | grep -A20 -B5 "Init Containers"
```

## 📖 Next Steps

<CardGroup cols={2}>
  <Card title="⚙️ Configuration" href="/latest/operator/configuration" icon="gear">
    Learn about configuration options
  </Card>
  <Card title="📖 Usage Examples" href="/latest/operator/usage" icon="code">
    See practical examples
  </Card>
  <Card title="🔧 Troubleshooting" href="/latest/operator/troubleshooting" icon="wrench">
    Debug API-related issues
  </Card>
  <Card title="🔒 Security" href="/latest/operator/security" icon="shield-check">
    Implement security best practices
  </Card>
</CardGroup>
